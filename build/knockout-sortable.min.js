//knockout-sortable | (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license
(function(a,b,c){var d=function(b){var c={},d=a.utils.unwrapObservable(b());return d.data?(c.foreach=d.data,c.name=d.template,c.afterAdd=d.afterAdd,c.beforeRemove=d.beforeRemove,c.afterRender=d.afterRender,c.includeDestroyed=d.includeDestroyed,c.templateEngine=d.templateEngine):c.foreach=b(),d.afterRender?c.afterRender=function(b,c){a.bindingHandlers.sortable.afterRender.call(c,b,c),d.afterRender.call(c,b,c)}:c.afterRender=a.bindingHandlers.sortable.afterRender,c},e="ko_sortItem",f="ko_sortList",g="ko_parentList";a.bindingHandlers.sortable={init:function(h,i,j,k,l){var m=b(h),n=a.utils.unwrapObservable(i()),o=d(i),p=a.bindingHandlers.sortable,q=n.connectClass||p.connectClass,r=n.allowDrop===c?p.allowDrop:n.allowDrop,s=n.beforeMove||p.beforeMove,t=n.afterMove||p.afterMove,u=n.options||p.options;return a.isObservable(r)||typeof r=="function"?a.computed({read:function(){var b=a.utils.unwrapObservable(r),c=typeof b=="function"?b.call(this,o.foreach):b;a.utils.toggleDomNodeCssClass(h,q,c)},disposeWhenNodeIsRemoved:h},this):a.utils.toggleDomNodeCssClass(h,q,r),a.utils.domData.set(h,f,o.foreach),m.sortable(a.utils.extend(u,{update:function(c,d){var h,i,j,k,l=d.item[0],m=a.utils.domData.get(l,e);if(m){h=a.utils.domData.get(l,g),i=a.utils.domData.get(l.parentNode,f),j=a.utils.arrayIndexOf(d.item.parent().children(),l);if(s||t)k={item:m,sourceParent:h,sourceIndex:h.indexOf(m),targetParent:i,targetIndex:j,cancelDrop:!1};if(s){s.call(this,k,c,d);if(k.cancelDrop){b(d.sender).sortable("cancel");return}}j>=0&&(a.utils.arrayRemoveItem(h(),m),h!==i&&h.valueHasMutated(),i.splice(j,0,m)),d.item.remove(),t&&t.call(this,k,c,d)}},connectWith:"."+q})),a.utils.domNodeDisposal.addDisposeCallback(h,function(){m.sortable("destroy")}),a.bindingHandlers.template.init(h,function(){return o},j,k,l)},update:function(b,c,e,f,g){var h=d(c);a.bindingHandlers.template.update(b,function(){return h},e,f,g)},afterRender:function(b,c){a.utils.arrayForEach(b,function(b){b.nodeType===1&&(a.utils.domData.set(b,e,c),a.utils.domData.set(b,g,a.utils.domData.get(b.parentNode,f)))})},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}}})(ko,jQuery)